<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniproSG · POS Admin</title>
     <link rel="icon" type="image/png" href="unipro-logo-white.png">
    <link rel="shortcut icon" href="unipro-logo-white.png">
    
    <!-- For better compatibility -->
    <link rel="apple-touch-icon" href="unipro-logo-white.png">
    <!-- Flatpickr for datetime -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <!-- Font Awesome 6 (Free) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(145deg, #0b1120 0%, #192132 100%);
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background grid */
        body::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(rgba(76, 130, 250, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(76, 130, 250, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            top: 0;
            left: 0;
            pointer-events: none;
            animation: gridMove 20s linear infinite;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Floating orbs */
        .orb {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(76, 130, 250, 0.4), rgba(76, 130, 250, 0));
            filter: blur(60px);
            pointer-events: none;
            z-index: 0;
        }

        .orb-1 { top: -100px; left: -100px; animation: float 15s ease-in-out infinite; }
        .orb-2 { bottom: -150px; right: -50px; width: 400px; height: 400px; 
                background: radial-gradient(circle at 30% 30%, rgba(0, 230, 200, 0.3), transparent);
                animation: float 20s ease-in-out infinite reverse; }
        .orb-3 { top: 50%; left: 50%; transform: translate(-50%, -50%);
                width: 600px; height: 600px;
                background: radial-gradient(circle at 30% 30%, rgba(156, 39, 176, 0.2), transparent);
                filter: blur(80px); }

        @keyframes float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(40px, 20px); }
        }

        .container {
            max-width: 1440px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        /* Glass card effect */
        .glass-card {
            background: rgba(20, 30, 50, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 28px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* Header with Logo */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 20px 28px;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        /* ✅ FIXED: Company logo with transparent background */
     .company-logo-container {
    width: 60px;        /* Increased from 10px to 60px */
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: transparent;
    border-radius: 12px;  /* Optional: rounded corners */
}

   .company-logo-img {
    width: 50px;
    height: 50px;
    object-fit: contain;
    filter: brightness(0) invert(1);
}
 .logo-text h1 {
            font-size: 24px;
            font-weight: 600;
            color: white;
        }

        .logo-text p {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            margin-top: 4px;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px 28px;
            border-radius: 40px;
            font-size: 15px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Stats cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(30, 40, 60, 0.6);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 24px;
            padding: 24px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            background: rgba(40, 50, 70, 0.7);
            border-color: rgba(74, 144, 226, 0.3);
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #4A90E2, #9B51E0);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            margin-bottom: 16px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.5);
        }

        /* Create license card */
        .create-card {
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: white;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: #4A90E2;
            font-size: 20px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

      .input-group {
    position: relative;
    width: 100%;
}

.input-group input {
    width: 100%;
    padding: 16px 45px 16px 48px;  /* Right padding for toggle button */
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 16px;
    font-size: 15px;
    color: white;
    transition: all 0.3s ease;
}
.input-group i:first-child {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: rgba(255, 255, 255, 0.4);
    font-size: 16px;
    z-index: 1;
}

        .input-group i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.4);
            font-size: 16px;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 16px 16px 16px 48px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            font-size: 15px;
            color: white;
            transition: all 0.3s ease;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #4A90E2;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.15);
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        /* DateTime range */
        .datetime-range {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .datetime-input {
            position: relative;
        }

        .datetime-input label {
            display: block;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 8px;
            margin-left: 8px;
        }

        .datetime-input input {
            width: 100%;
            padding: 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            font-size: 14px;
            color: white;
            cursor: pointer;
        }

        /* Test buttons */
        .test-buttons {
            display: flex;
            gap: 12px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .test-btn {
            flex: 1;
            min-width: 120px;
            padding: 14px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 40px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .test-btn:hover {
            background: rgba(74, 144, 226, 0.2);
            border-color: #4A90E2;
            color: white;
            transform: translateY(-2px);
        }

        .test-btn i { font-size: 14px; }

        /* Create button */
        .create-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #4A90E2, #9B51E0);
            border: none;
            border-radius: 40px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .create-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 30px -10px rgba(74, 144, 226, 0.4);
        }

        /* Shops table */
        .table-card {
            padding: 30px;
            overflow-x: auto;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .search-box {
            position: relative;
            width: 300px;
        }

        .search-box i {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.4);
        }
.logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #4A90E2, #9B51E0);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .search-box input {
            width: 100%;
            padding: 14px 14px 14px 46px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 40px;
            color: white;
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 16px 12px;
            color: rgba(255, 255, 255, 0.5);
            font-weight: 500;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        td {
            padding: 20px 12px;
            color: white;
            font-size: 14px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        tr:hover td {
            background: rgba(255, 255, 255, 0.02);
        }

        .license-key {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            background: rgba(255, 255, 255, 0.05);
            padding: 6px 10px;
            border-radius: 8px;
        }

        .status-badge {
            padding: 6px 14px;
            border-radius: 40px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .status-active {
            background: rgba(0, 230, 150, 0.15);
            color: #00e699;
            border: 1px solid rgba(0, 230, 150, 0.3);
        }

        .status-expired {
            background: rgba(255, 70, 70, 0.15);
            color: #ff4646;
            border: 1px solid rgba(255, 70, 70, 0.3);
        }

        .status-warning {
            background: rgba(255, 170, 0, 0.15);
            color: #ffaa00;
            border: 1px solid rgba(255, 170, 0, 0.3);
        }

        .renew-btn {
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 40px;
            color: white;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .renew-btn:hover {
            background: #4A90E2;
            border-color: #4A90E2;
        }

        .renew-btn.expired:hover {
            background: #ff4646;
            border-color: #ff4646;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            width: 90%;
            max-width: 550px;
            background: rgba(20, 30, 50, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 32px;
            padding: 32px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-header h3 {
            color: white;
            font-size: 24px;
            font-weight: 600;
        }

        .close-modal {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close-modal:hover {
            background: #ff4646;
            border-color: #ff4646;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .modal-btn {
            flex: 1;
            padding: 16px;
            border-radius: 40px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .modal-btn.cancel {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-btn.renew {
            background: linear-gradient(135deg, #4A90E2, #9B51E0);
            color: white;
        }

        .modal-btn.renew:hover { transform: translateY(-2px); box-shadow: 0 10px 20px -5px rgba(74, 144, 226, 0.4); }
        .modal-btn.cancel:hover { background: rgba(255, 255, 255, 0.1); }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .login-card {
            width: 400px;
            padding: 40px;
            text-align: center;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #4A90E2, #9B51E0);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: white;
            margin: 0 auto 24px;
        }

        .login-title {
            font-size: 28px;
            font-weight: 600;
            color: white;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 32px;
        }

        /* Footer with Company Logo */
        .footer {
            margin-top: 30px;
            text-align: center;
            padding: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .footer-logo-img {
            width: 30px;
            height: 30px;
            object-fit: contain;
            background: transparent;  /* No white background */
        }

        .footer-text {
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
        }
        /* Login page logo styles */
.login-logo-container {
    width: 100px;
    height: 100px;
    margin: 0 auto 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #4A90E2, #9B51E0);
    border-radius: 30px;
    padding: 15px;
}
/* Password toggle button styles */
/* Password toggle button styles */
.password-wrapper {
    width: 100%;
    margin-bottom: 24px;
}
.password-toggle {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: none;
    color: rgba(255, 255, 255, 0.5);
    cursor: pointer;
    padding: 8px;
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    transition: all 0.3s ease;
}
.password-toggle:hover {
    color: #4A90E2;
}
.password-toggle i {
    font-size: 18px;
}

/* Ensure no overlap */
.password-input {
    padding-right: 50px !important;  /* Space for toggle button */
}
/* For light mode support */
body.light-mode .password-toggle {
    color: #64748b;
}

body.light-mode .password-toggle:hover {
    color: #4A90E2;
}
.input-group input:focus {
    outline: none;
    border-color: #4A90E2;
    background: rgba(255, 255, 255, 0.1);
    box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.15);
}
.login-logo-img {
    width: 70px;
    height: 70px;
    object-fit: contain;
    filter: brightness(0) invert(1); /* Makes logo white */
}
    </style>
</head>
<body>
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>

    <div class="container">
        <!-- Login Section -->
     <!-- Login Section with Company Logo -->
<div id="login" class="login-container">
    <div class="glass-card login-card">
        <!-- ✅ Company Logo instead of crown icon -->
        <div class="login-logo-container">
            <img src="unipro-logo-white.png" 
                 alt="UniproSG Logo" 
                 class="login-logo-img"
                 onerror="this.src='https://via.placeholder.com/80x80/4A90E2/ffffff?text=U'">
        </div>
        <h2 class="login-title">Welcome back</h2>
        <p class="login-subtitle">Sign in to manage licenses</p>
        
        <div class="input-group" style="margin-bottom: 16px;">
            <i class="fas fa-user"></i>
            <input type="text" id="adminUser" placeholder="Username">
        </div>
        
   <!-- Password field with toggle - FIXED ALIGNMENT -->
<div class="password-wrapper" style="margin-bottom: 24px;">
    <div class="input-group">
        <i class="fas fa-lock"></i>
        <input type="password" id="adminPass" placeholder="Password" class="password-input">
        <button type="button" class="password-toggle" onclick="togglePassword()">
            <i class="fas fa-eye" id="eyeIcon"></i>
        </button>
    </div>
</div>
 <button class="create-btn" onclick="adminLogin()">
            <i class="fas fa-arrow-right-to-bracket"></i>
            Sign In
        </button>
    </div>
</div>
        <!-- Admin Panel -->
        <div id="adminPanel" style="display: none;">
            <!-- Header -->
            <!-- Header - FIXED VERSION -->
<div class="glass-card header">
    <div class="logo-area">
        <div class="company-logo-container">
            <!-- ✅ FIXED: Added class="company-logo-img" -->
            <img src="unipro-logo-white.png" 
                 alt="UniproSG Logo" 
                 class="company-logo-img">  <!-- ← I added the class! -->
        </div>
        <div class="logo-text">
            <h1></i>UniproSG License Management</h1>
            <p></i>POS System Administration</p>
        </div>
    </div>
    <button class="logout-btn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i>
        Sign Out
    </button>
</div>

            <!-- Stats -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-store"></i></div>
                    <div class="stat-value" id="totalShops">0</div>
                    <div class="stat-label">Total Shops</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-value" id="activeShops">0</div>
                    <div class="stat-label">Active Licenses</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-clock"></i></div>
                    <div class="stat-value" id="expiringShops">0</div>
                    <div class="stat-label">Expiring Soon</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-times-circle"></i></div>
                    <div class="stat-value" id="expiredShops">0</div>
                    <div class="stat-label">Expired</div>
                </div>
            </div>

            <!-- Create License -->
            <div class="glass-card create-card">
                <div class="section-title">
                    <i class="fas fa-plus-circle"></i>
                    <span>Create New Shop License</span>
                </div>

                <div class="form-grid">
                    <div class="input-group">
                        <i class="fas fa-store"></i>
                        <input type="text" id="shopName" placeholder="Shop Name">
                    </div>
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" id="username" placeholder="Username">
                    </div>
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" id="password" placeholder="Password">
                    </div>
                   
                </div>

                <div class="datetime-range">
                    <div class="datetime-input">
                        <label><i class="far fa-calendar-alt"></i> Start Date & Time</label>
                        <input type="text" id="startDateTime" placeholder="Select start">
                    </div>
                    <div class="datetime-input">
                        <label><i class="far fa-calendar-check"></i> End Date & Time</label>
                        <input type="text" id="endDateTime" placeholder="Select end">
                    </div>
                </div>

               

                <button class="create-btn" onclick="createLicense()">
                    <i class="fas fa-magic"></i>
                    Generate License
                </button>
            </div>

            <!-- Shops Table -->
            <div class="glass-card table-card">
                <div class="table-header">
                    <div class="section-title">
                        <i class="fas fa-store-alt"></i>
                        <span>Shop Licenses</span>
                    </div>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchShops" placeholder="Search shops..." onkeyup="filterShops()">
                    </div>
                </div>

                <div id="shopsList">
                    <div style="text-align: center; padding: 60px; color: rgba(255,255,255,0.3);">
                        <i class="fas fa-spinner fa-spin fa-3x"></i>
                        <p style="margin-top: 20px;">Loading shops...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Renew Modal -->
    <div id="renewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-sync-alt" style="margin-right: 12px; color: #4A90E2;"></i>Renew License</h3>
                <div class="close-modal" onclick="closeRenewModal()">
                    <i class="fas fa-times"></i>
                </div>
            </div>

            <input type="hidden" id="renewUserId">

            <div class="datetime-range" style="grid-template-columns: 1fr;">
                <div class="datetime-input">
                    <label><i class="far fa-calendar-alt"></i> Start Date & Time</label>
                    <input type="text" id="renewStartDateTime" placeholder="Select start">
                </div>
                <div class="datetime-input">
                    <label><i class="far fa-calendar-check"></i> End Date & Time</label>
                    <input type="text" id="renewEndDateTime" placeholder="Select end">
                </div>
            </div>

            <div class="modal-actions">
                <button class="modal-btn cancel" onclick="closeRenewModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="modal-btn renew" onclick="submitRenew()">
                    <i class="fas fa-check"></i> Renew License
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script>
        const API_URL = 'http://192.168.0.169:5000/api';
        let adminToken = '';
        let startPicker, endPicker, renewStartPicker, renewEndPicker;

        // Initialize date pickers
        function initDateTimePickers() {
            startPicker = flatpickr("#startDateTime", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                time_24hr: true,
                minuteIncrement: 1,
                defaultDate: new Date(),
                onChange: function(selectedDates) {
                    if (endPicker) {
                        endPicker.set('minDate', selectedDates[0]);
                    }
                }
            });
            
            endPicker = flatpickr("#endDateTime", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                time_24hr: true,
                minuteIncrement: 1,
                defaultDate: new Date(new Date().getTime() + 30*24*60*60*1000)
            });
        }

        // Test functions
       

        // Filter shops
        function filterShops() {
            const search = document.getElementById('searchShops').value.toLowerCase();
            const rows = document.querySelectorAll('#shopsTable tr');
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(search) ? '' : 'none';
            });
        }

        // Format date
        function formatDate(isoString) {
            if (!isoString) return 'N/A';
            const clean = isoString.split('.')[0].replace('Z', '');
            const [datePart, timePart] = clean.split('T');
            const [year, month, day] = datePart.split('-');
            const [hours, minutes] = timePart.split(':');
            return `${day}/${month}/${year}, ${hours}:${minutes}`;
        }

        // Calculate time left
        function calculateTimeLeft(expiryString) {
            if (!expiryString) return { text: 'No License', class: '' };
            
            const clean = expiryString.split('.')[0].replace('Z', '');
            const [datePart, timePart] = clean.split('T');
            const [year, month, day] = datePart.split('-').map(Number);
            const [hours, minutes] = timePart.split(':').map(Number);
            
            const expiryDate = new Date(year, month-1, day, hours, minutes);
            const now = new Date();
            
            const diffMs = expiryDate - now;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            
            if (diffMins < 0) return { text: 'Expired', class: 'status-expired' };
            if (diffMins < 60) return { text: `${diffMins} minutes`, class: 'status-warning' };
            if (diffMins < 1440) {
                const h = Math.floor(diffMins / 60);
                const m = diffMins % 60;
                return { text: `${h}h ${m}m`, class: 'status-warning' };
            }
            const d = Math.floor(diffMins / 1440);
            const h = Math.floor((diffMins % 1440) / 60);
            return { 
                text: `${d}d ${h}h`, 
                class: d < 7 ? 'status-warning' : 'status-active'
            };
        }

        // Update stats
        function updateStats(shops) {
            const total = shops.length;
            const active = shops.filter(s => {
                const timeLeft = calculateTimeLeft(s.ExpiryDate);
                return !timeLeft.text.includes('Expired') && !timeLeft.text.includes('No License');
            }).length;
            const expired = shops.filter(s => {
                const timeLeft = calculateTimeLeft(s.ExpiryDate);
                return timeLeft.text.includes('Expired');
            }).length;
            const expiring = shops.filter(s => {
                const timeLeft = calculateTimeLeft(s.ExpiryDate);
                return timeLeft.class === 'status-warning' && !timeLeft.text.includes('Expired');
            }).length;

            document.getElementById('totalShops').textContent = total;
            document.getElementById('activeShops').textContent = active;
            document.getElementById('expiredShops').textContent = expired;
            document.getElementById('expiringShops').textContent = expiring;
        }

        // Load shops
        async function loadShops() {
            try {
                const res = await fetch(`${API_URL}/admin/shops`, {
                    headers: { 'Authorization': `Bearer ${adminToken}` }
                });
                const shops = await res.json();
                
                let html = '<table id="shopsTable"><thead><tr>';
                html += '<th>Shop</th><th>Username</th><th>License Key</th><th>Start</th><th>Expiry</th><th>Status</th><th>Time Left</th><th>Action</th>';
                html += '</tr></thead><tbody>';
                
                shops.forEach(shop => {
                    const startDate = formatDate(shop.StartDate);
                    const expiryDate = formatDate(shop.ExpiryDate);
                    const timeLeft = calculateTimeLeft(shop.ExpiryDate);
                    
                    let statusClass = '';
                    let statusText = shop.LicenseStatus || 'Unknown';
                    
                    if (timeLeft.text === 'Expired') {
                        statusClass = 'status-expired';
                        statusText = 'Expired';
                    } else if (timeLeft.class === 'status-warning') {
                        statusClass = 'status-warning';
                        statusText = 'Expiring';
                    } else {
                        statusClass = 'status-active';
                        statusText = 'Active';
                    }
                    
                    html += `<tr>
                        <td><strong>${shop.ShopName || '-'}</strong></td>
                        <td>${shop.Username}</td>
                        <td><span class="license-key">${shop.LicenseKey || 'N/A'}</span></td>
                        <td>${startDate}</td>
                        <td>${expiryDate}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td><span class="status-badge ${timeLeft.class}">${timeLeft.text}</span></td>
                        <td>
                            <button class="renew-btn ${timeLeft.text === 'Expired' ? 'expired' : ''}" onclick="showRenewModal(${shop.Id})">
                                <i class="fas fa-sync-alt"></i> Renew
                            </button>
                        </td>
                    </tr>`;
                });
                
                html += '</tbody></table>';
                document.getElementById('shopsList').innerHTML = html;
                updateStats(shops);
                
            } catch (error) {
                document.getElementById('shopsList').innerHTML = '<div style="text-align: center; padding: 60px; color: #ff4646;"><i class="fas fa-exclamation-triangle fa-3x"></i><p style="margin-top: 20px;">Error loading shops</p></div>';
            }
        }

        // Admin login
        async function adminLogin() {
            try {
                const res = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        username: document.getElementById('adminUser').value,
                        password: document.getElementById('adminPass').value
                    })
                });
                
                const data = await res.json();
                if (res.ok && data.user.role === 'admin') {
                    adminToken = data.token;
                    document.getElementById('login').style.display = 'none';
                    document.getElementById('adminPanel').style.display = 'block';
                    initDateTimePickers();
                    loadShops();
                } else {
                    alert('Invalid admin credentials');
                }
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        }

        // Create license
        async function createLicense() {
            try {
                const startDateTime = document.getElementById('startDateTime').value;
                const endDateTime = document.getElementById('endDateTime').value;
                
                if (!startDateTime || !endDateTime) {
                    alert('Please select start and end dates');
                    return;
                }
                
                const res = await fetch(`${API_URL}/admin/create-shop`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}`
                    },
                    body: JSON.stringify({
                        shopName: document.getElementById('shopName').value,
                        username: document.getElementById('username').value,
                        password: document.getElementById('password').value,
                        startDate: startDateTime,
                        endDate: endDateTime
                    })
                });
                
                const data = await res.json();
                if (res.ok) {
                    alert(`✅ License created successfully!`);
                    loadShops();
                    
                    // Clear form
                    document.getElementById('shopName').value = '';
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Creation failed: ' + error.message);
            }
        }
// Toggle password visibility
function togglePassword() {
    const passwordInput = document.getElementById('adminPass');
    const eyeIcon = document.getElementById('eyeIcon');
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        eyeIcon.className = 'fas fa-eye-slash';
    } else {
        passwordInput.type = 'password';
        eyeIcon.className = 'fas fa-eye';
    }
}
        // Renew modal
        function showRenewModal(userId) {
            document.getElementById('renewUserId').value = userId;
            document.getElementById('renewModal').style.display = 'flex';
            
            const now = new Date();
            
            renewStartPicker = flatpickr("#renewStartDateTime", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                time_24hr: true,
                minuteIncrement: 1,
                defaultDate: now,
                onChange: function(selectedDates) {
                    renewEndPicker.set('minDate', selectedDates[0]);
                }
            });
            
            renewEndPicker = flatpickr("#renewEndDateTime", {
                enableTime: true,
                dateFormat: "Y-m-d H:i",
                time_24hr: true,
                minuteIncrement: 1,
                defaultDate: new Date(now.getTime() + 30*24*60*60*1000)
            });
        }

        function closeRenewModal() {
            document.getElementById('renewModal').style.display = 'none';
        }

        async function submitRenew() {
            const userId = document.getElementById('renewUserId').value;
            const startDate = document.getElementById('renewStartDateTime').value;
            const endDate = document.getElementById('renewEndDateTime').value;
            
            if (!startDate || !endDate) {
                alert('Please select start and end dates');
                return;
            }
            
            try {
                const res = await fetch(`${API_URL}/admin/renew-license/${userId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}`
                    },
                    body: JSON.stringify({ startDate, endDate })
                });
                
                if (res.ok) {
                    alert('✅ License renewed successfully!');
                    closeRenewModal();
                    loadShops();
                } else {
                    const data = await res.json();
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Renewal failed: ' + error.message);
            }
        }

        function logout() {
            adminToken = '';
            document.getElementById('login').style.display = 'flex';
            document.getElementById('adminPanel').style.display = 'none';
        }
    </script>
</body>
</html>